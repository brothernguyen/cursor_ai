<p-toast />
<div class="reset-password-container">
  <div class="reset-password-background"></div>
  <div class="reset-password-card">
    <div class="logo-container">
      <h1 class="logo-text">Admin</h1>
    </div>
    <div class="section">
      <h2 class="heading">Set new password</h2>
      <p class="subheading">Choose a strong password for your account.</p>
    </div>

    @if (hasRecoverySession() === null) {
      <div class="form-content">
        <p class="loading-message">Checking link...</p>
      </div>
    } @else if (showForm()) {
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="form-content">
          <div class="field">
            <label for="password" class="field-label">New password</label>
            <p-password
              id="password"
              formControlName="password"
              placeholder="Enter new password"
              [toggleMask]="true"
              [fluid]="true"
              [feedback]="false"
            />
            <small
              *ngIf="password.invalid && (password.dirty || password.touched)"
              class="error-message"
            >
              <div *ngIf="password.errors?.['required']">Password is required</div>
              <div *ngIf="password.errors?.['minlength']">At least 8 characters</div>
            </small>
          </div>
          <div class="field">
            <label for="confirmPassword" class="field-label">Confirm password</label>
            <p-password
              id="confirmPassword"
              formControlName="confirmPassword"
              placeholder="Confirm new password"
              [toggleMask]="true"
              [fluid]="true"
              [feedback]="false"
            />
            <small
              *ngIf="(form.errors?.['passwordMismatch'] || confirmPassword.invalid) && (confirmPassword.dirty || confirmPassword.touched)"
              class="error-message"
            >
              <div *ngIf="form.errors?.['passwordMismatch']">Passwords do not match</div>
              <div *ngIf="confirmPassword.errors?.['required']">Confirm password is required</div>
            </small>
          </div>
          <p-button
            type="submit"
            [disabled]="!form.valid || isSubmitting"
            [loading]="isSubmitting"
            styleClass="signin-button"
            label="{{ isSubmitting ? 'Updating...' : 'Update password' }}"
          />
          <div class="back-container">
            <a routerLink="/login" class="back-link">Back to Sign In</a>
          </div>
        </div>
      </form>
    } @else if (showInvalidLink()) {
      <div class="form-content">
        <p class="invalid-message">
          This link is invalid or has expired. Request a new password reset below.
        </p>
        <p-button
          label="Request new reset link"
          styleClass="signin-button"
          [routerLink]="['/forgot-password']"
        />
        <div class="back-container">
          <a routerLink="/login" class="back-link">Back to Sign In</a>
        </div>
      </div>
    }
  </div>
</div>
